%!TEX root = SysSpec_ClockPendulumAnalyzer.tex
\subsection{Umsetzung des Counters} %TODO Counter Realisierung beschreiben
<<<<<<< HEAD
Der Tick-Conter zwischen den Pendeldurchgängen basiert auf einem Freilaufendem Hardware-Zähler, welcher auf dem Tiny K20 Mikrocontrollerboard läuft, getrieben von dem vorhandenen, termperaturkorrigieren 8MHz Quarz, Mittels Hardware-Einstellung des CPU-Blocks auf 12MHz erhöht. Da diese Erhöhung rein auf Hardware-Einstellungen beruht, wird die Genauigkeit dadurch nicht beeinflusst. Um die Schwankungen des Zählers auszugleichen wird der Sekundenpuls des GPS-Moduls über zwei unabhängige IO-Pins genutzt. Eine Leitung, für den Fall, dass keine GPS-Verbindung besteht, am FIX-Pin des GPS-Moduls angeschlossen und eine Zweite, falls GPS-Verbindung besteht, amm PPS-Pin des GPS-Moduls. Beide Leitungen funktionieren über einen Interrupt der höchsten Priorität. Falls am PPS-Pin Interrupts eingehen, wird der FIX-Pin ignoriert. Beim Umschalten zwischen GPS-Empfang und keinem GPS-Empfang kann daher ein Fehler entstehen, weshalb, dann die nächsten Messwerte mit 0 belegt nach aussen gesendet werden, um diese Messung zu verwerfen. Im Normalbetrieb werden die Interrupts an den IO-Pins, eingehend vom GPS-Modul, dazu genutzt die Differenz zwischen dem vorigen Zählerwert und dem aktuellen Zählerwert zu bilden und so die effektive Frequenz zu ermitteln.\\ 
Die Pendeldurchgänge werden über einen weiteren IO-Pin über einen Interrupt der höchsten Priorität ermittelt. Dabei wird jede zweite Messung verworfen, um das Pendel immer von der gleichen Seite zu messen. Der ermittelte Zählerwert wird mit der ermittelten Frequenz verrechnet und über die UART-RS232 Schnittstelle gesendet.\\
Die Verrechnungskorrektur erfolgt über folgende Formel:
\[
	T_{abs} = \frac{T_{measured} \cdot f_{ref}}{f_{real}}
\]
\subsubsection{Genauigkeit Referenzfrequenz TinyK20}
Die Genauigkeit der Referenzfrequenz ist mittels statistischer Methoden ermittelt worden. Dazu sind zwei Versuchstreihen durchgeführt worden. Jeweils zwanzig Vergleiche mit dem FIX-Pin als Sekundenpuls, somit ohne GPS-Verbiundung und 20 Messungen mit dem PPS-Pin als Sekundenpuls. Temperatur und Luftfeuchtigkeit sind mit einem Sensirion SHTC1- Sensor ermittelt worden.\\
Es sind im Anschluss folgende Untersuchungen erfolgt:
\begin{itemize}
	\item Streuung der Daten mit Hilfe eines Histogramms und Box-Plots
	\item sowie eine Prüfung auf die Verteilung mittels QQ-Plot.
	\item Ubegumgstemperatur: 23.74°.
	\item Luftfeuchtigkeit: 27.16%
\end{itemize}
Der Boxplot in Abbildung \ref{fig:ferq_boxplot} zeigt auf, dass die Genauigkeit des Sekundenpulses des GPS-Modules deutlich von der Genauigkeit des PPS-Signals abweicht. Im vorhandenen Versuch liegt die Streuung ohne GPS-Empfang bei 78ppm während die Streuung mit GPS noch 21ppm beträgt. Die Zahlen entsprechen der Summe de folgender Fehler:
\begin{itemize}
	\item Signals des GPS-Modules.
	\item Registrierung des Interrupts.
	\item Ungenauigkeit des Hardware-Zählers.
	\item Auswerten des Zählerstandes und Differenzbildung. 
\end{itemize}
	\begin{figure}[H]
		\centering
		\includegraphics[width=.7\textwidth]{frequencies_boxplot}
		\caption{Boxplot der Versuchsreihen}
		\label{fig:freq_boxplot}
	\end{figure}
%
Weiter kann dem Boxplot entnommen werden, dass die Streuung der Werte gleichmässig um den Median erfolgen und keine Ausreisser vorhanden sind. Dies legt die Vermutung nahe, dass sich die Streuung Normalverteilt verhält, was bedeuten würde, dass sich der Fehler über lange Sicht aufhebt, bis auf eine Konstante Abweichung, welche sich mit der Differenz zwichen Erwartungswert und dem definierten Wert ermitteln lässt. Diese Vermutung ist mit einem Historgramm (Abbildung \ref{fig:freq_histograms}) und einem QQ-Plot (Abbildung \ref{fig:freq_qq_plot}) überprüft worden.
	\begin{figure}[H]
		\centering
		\includegraphics[width=.9\textwidth]{histograms_frequencies}
		\caption{Histogramme der ermittelten Zählerdaten}
		\label{fig:freq_histograms}
	\end{figure}
	Das Histogramm alleine ist bezüglich der Verteilung noch nicht aussagekräftig, dem QQ-Plot kann man anschliessend entnehmen, dass sich die Werte einer Normalverteilung nähern.
	\begin{figure}[H]
		\centering
		\includegraphics[width=.9\textwidth]{frequencies_qq_plots}
		\caption{QQ-Plots der ermittelten Zählerdaten}
		\label{fig:freq_qq_plot}
	\end{figure}
GPS-Modul und Tiny K20 sind auf einem Board gemeinsam angebracht, ebenfalls auf diesem Board befindet sich die RTC und er Anschluss für den Sensor für die Pendel-Registrierung (Abbildung \ref{fig:hardwareboard}).
=======
Der Tick-Counter zwischen den Pendeldurchgängen basiert auf einem freilaufendem Zähler, welcher auf dem TinyK20 Mikrocontrollerboard läuft, getrieben von dem vorhandenen, termperaturkorrigierenden 8MHz Quarz.
Um die Schwankungen des Zählers auszugleichen wird der Sekundenpuls des GPS-Moduls über zwei unabhängige IO-Pins genutzt. Eine Leitung, für den Fall, dass keine GPS-Verbindung besteht, am FIX-Pin des GPS-Moduls angeschlossen und eine zweite Leitung, falls GPS-Verbindung besteht, am PPS-Pin des GPS-Moduls.\\
Beide Leitungen funktionieren über einen Interrupt der höchsten Priorität. Falls am PPS-Pin Interrupts eingehen, wird der FIX-Pin ignoriert. Beim Umschalten zwischen GPS-Empfang und keinem GPS-Empfang kann daher ein Fehler entstehen, weshalb, dann die nächsten Messwerte mit 0 belegt nach aussen gesendet werden, um diese Messung zu verwerfen.
Im Normalbetrieb werden die Interrupts an den IO-Pins, eingehend vom GPS-Modul, dazu genutzt die Differenz zwischen dem letzten Zählerwert und dem aktuellen Zählerwert zu bilden und so die effektive Frequenz zu ermitteln.\\ 
Die Pendeldurchgänge werden über einen weiteren IO-Pin über einen Interrupt der höchsten Priorität ermittelt. Dabei wird jede zweite Messung verworfen, um das Pendel immer von der gleichen Seite zu messen. Der ermittelte Zählerwert wird gemeinsam mit der ermittelten Frequenz gespeichert und bei Anfrage über die \iic\ Schnittstelle gesendet.\\
\\
GPS-Modul und TinyK20 sind auf einem Board gemeinsam angebracht, ebenfalls auf diesem Board befindet sich die RTC und er Anschluss für den Sensor für die Pendel-Registrierung (Abbildung \ref{fig:hardware_board}).
>>>>>>> ad7abfe8d610e26236c446c2974077f3a945a9bc
	\begin{figure}[H]
		\centering
		\includegraphics[width=.7\textwidth]{HW_Board_Complete}
		\caption{Gesamtanordnug der Hardware-Komponenten}
<<<<<<< HEAD
		\label{fig:hardwareboard}
=======
		\label{fig:hardware_board}
>>>>>>> ad7abfe8d610e26236c446c2974077f3a945a9bc
	\end{figure}